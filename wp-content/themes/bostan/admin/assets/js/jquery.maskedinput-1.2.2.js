!function(e){var t=(e.browser.msie?"paste":"input")+".mask",n=null!=window.orientation;e.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"}},e.fn.extend({caret:function(e,t){if(0!=this.length){if("number"==typeof e)return t="number"==typeof t?t:e,this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(e,t);else if(this.createTextRange){var n=this.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select()}});if(this[0].setSelectionRange)e=this[0].selectionStart,t=this[0].selectionEnd;else if(document.selection&&document.selection.createRange){var n=document.selection.createRange();e=0-n.duplicate().moveStart("character",-1e5),t=e+n.text.length}return{begin:e,end:t}}},unmask:function(){return this.trigger("unmask")},mask:function(a,r){if(!a&&this.length>0){var i=e(this[0]),o=i.data("tests");return e.map(i.data("buffer"),function(e,t){return o[t]?e:null}).join("")}r=e.extend({placeholder:"_",completed:null},r);var c=e.mask.definitions,l=(o=[],a.length),s=null,u=a.length;return e.each(a.split(""),function(e,t){"?"==t?(u--,l=e):c[t]?(o.push(new RegExp(c[t])),null==s&&(s=o.length-1)):o.push(null)}),this.each(function(){var i=e(this),f=e.map(a.split(""),function(e,t){if("?"!=e)return c[e]?r.placeholder:e}),h=!1,d=i.val();function v(e){for(;++e<=u&&!o[e];);return e}function m(e,t){for(var n=e;n<t&&n<u;n++)o[n]&&(f[n]=r.placeholder)}function g(){return i.val(f.join("")).val()}function b(e){for(var t=i.val(),n=-1,a=0,c=0;a<u;a++)if(o[a]){for(f[a]=r.placeholder;c++<t.length;){var h=t.charAt(c-1);if(o[a].test(h)){f[a]=h,n=a;break}}if(c>t.length)break}else f[a]==t[c]&&a!=l&&(c++,n=a);return!e&&n+1<l?(i.val(""),m(0,u)):(e||n+1>=l)&&(g(),e||i.val(i.val().substring(0,n+1))),l?a:s}i.data("buffer",f).data("tests",o),i.attr("readonly")||i.one("unmask",function(){i.unbind(".mask").removeData("buffer").removeData("tests")}).bind("focus.mask",function(){d=i.val();var e=b();g(),setTimeout(function(){e==a.length?i.caret(0,e):i.caret(e)},0)}).bind("blur.mask",function(){b(),i.val()!=d&&i.change()}).bind("keydown.mask",function(t){var a=e(this).caret(),c=t.keyCode;return h=c<16||c>16&&c<32||c>32&&c<41,a.begin-a.end==0||h&&8!=c&&46!=c||m(a.begin,a.end),8==c||46==c||n&&127==c?(function(e){for(;!o[e]&&--e>=0;);for(var t=e;t<u;t++)if(o[t]){f[t]=r.placeholder;var n=v(t);if(!(n<u&&o[t].test(f[n])))break;f[t]=f[n]}g(),i.caret(Math.max(s,e))}(a.begin+(46==c?0:-1)),!1):27==c?(i.val(d),i.caret(0,b()),!1):void 0}).bind("keypress.mask",function(t){if(h)return h=!1,8!=t.keyCode&&null;var n=(t=t||window.event).charCode||t.keyCode||t.which,a=e(this).caret();if(t.ctrlKey||t.altKey||t.metaKey)return!0;if(n>=32&&n<=125||n>186){var c=v(a.begin-1);if(c<u){var l=String.fromCharCode(n);if(o[c].test(l)){!function(e){for(var t=e,n=r.placeholder;t<u;t++)if(o[t]){var a=v(t),i=f[t];if(f[t]=n,!(a<u&&o[a].test(i)))break;n=i}}(c),f[c]=l,g();var s=v(c);e(this).caret(s),r.completed&&s==u&&r.completed.call(i)}}}return!1}).bind(t,function(){setTimeout(function(){i.caret(b(!0))},0)}),b()})}})}(jQuery);